name: Playwright E2E


on:
push:
branches: [ main ]
pull_request:


permissions:
contents: read
pages: write
id-token: write


jobs:
e2e:
runs-on: ubuntu-latest


steps:
- name: Checkout
uses: actions/checkout@v4


- name: Setup Node
uses: actions/setup-node@v4
with:
node-version: 20


- name: Install dependencies
run: yarn install --frozen-lockfile


- name: Start Grafana
run: docker-compose up -d


- name: Wait for Grafana
run: npx wait-on http://localhost:3000


- name: Run Playwright tests
run: yarn playwright test


- name: Upload Playwright report
uses: actions/upload-pages-artifact@v3
with:
path: playwright-report


deploy:
needs: e2e
runs-on: ubuntu-latest
environment:
name: github-pages
url: ${{ steps.deployment.outputs.page_url }}


steps:
- name: Deploy to GitHub Pages
id: deployment
uses: actions/deploy-pages@v4